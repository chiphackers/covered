<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Covered: sim.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.3 -->
<h1>sim.c File Reference</h1><code>#include &lt;assert.h&gt;</code><br>
<code>#include "<a class="el" href="defines_8h-source.html">defines.h</a>"</code><br>
<code>#include "<a class="el" href="sim_8h-source.html">sim.h</a>"</code><br>
<code>#include "<a class="el" href="expr_8h-source.html">expr.h</a>"</code><br>
<code>#include "<a class="el" href="vector_8h-source.html">vector.h</a>"</code><br>
<code>#include "<a class="el" href="iter_8h-source.html">iter.h</a>"</code><br>
<code>#include "<a class="el" href="link_8h-source.html">link.h</a>"</code><br>
<code>#include "<a class="el" href="signal_8h-source.html">signal.h</a>"</code><br>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a5">sim_expr_changed</a> (<a class="el" href="structexpression__s.html">expression</a> *expr)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds specified expression's statement to pre-simulation statement queue. </em> <a href="#a5"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a6">sim_add_stmt_to_queue</a> (<a class="el" href="structstatement__s.html">statement</a> *stmt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds specified statement to pre-simulation statement queue. </em> <a href="#a6"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a7">sim_add_statics</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds static expression values to initial simulator. </em> <a href="#a7"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a8">sim_expression</a> (<a class="el" href="structexpression__s.html">expression</a> *expr)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structstatement__s.html">statement</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a9">sim_statement</a> (<a class="el" href="structstatement__s.html">statement</a> *head_stmt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a10">sim_simulate</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Simulates current timestep. </em> <a href="#a10"></a><em><br><br></td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="defines_8h.html#a154">nibble</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a0">or_optab</a> [16]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structexp__link__s.html">exp_link</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a1">static_expr_head</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structexp__link__s.html">exp_link</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a2">static_expr_tail</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structstmt__link__s.html">stmt_link</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a3">presim_stmt_head</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structstmt__link__s.html">stmt_link</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="sim_8c.html#a4">presim_stmt_tail</a> = NULL</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<dl compact><dt><b>Author:</b></dt><dd>Trevor Williams (<a href="mailto:trevorw@charter.net">trevorw@charter.net</a>) </dd></dl>
<dl compact><dt><b>Date:</b></dt><dd>6/20/2002</dd></dl>
<dl compact><dt><b></b></dt><dd>The simulation engine is made up of three parts:<ol>
<li>pre-simulation statement queue</li><li>statement simulation engine</li><li>expression simulation engine</li></ol>
</dd></dl>
<dl compact><dt><b></b></dt><dd>The operation of the simulation engine is as follows. When a signal is found in the VCD file, the expressions to which it is a part of the RHS are looked up in the design tree. The expression tree is then parsed from the expression to the root, setting the <a class="el" href="group__expr__suppl.html#a9">SUPPL_LSB_LEFT_CHANGED</a> or <a class="el" href="group__expr__suppl.html#a10">SUPPL_LSB_RIGHT_CHANGED</a> as it makes its way to the root. When at the root expression, the <a class="el" href="group__expr__suppl.html#a4">SUPPL_LSB_STMT_HEAD</a> bit is interrogated. If this bit is a 1, the expression's statement is loaded into the pre-simulation statement queue. If the bit is a 0, no further action is taken.</dd></dl>
<dl compact><dt><b></b></dt><dd>Once the timestep marker has been set, the simulate function is called. The statement located at the head of the queue is placed into the statement simulation engine and the head pointer is set to point to the next statement in the queue. The head statement is continually taken until the pre-simulation statement queue is empty. This signifies that the timestep has been completed.</dd></dl>
<dl compact><dt><b></b></dt><dd>When a statement is placed into the statement simulation engine, the <a class="el" href="group__expr__suppl.html#a4">SUPPL_LSB_STMT_HEAD</a> bit is cleared in the root expression. Additionally, the root expression pointed to by the statement is interrogated to see if the <a class="el" href="group__expr__suppl.html#a9">SUPPL_LSB_LEFT_CHANGED</a> or <a class="el" href="group__expr__suppl.html#a10">SUPPL_LSB_RIGHT_CHANGED</a> bits are set. If one or both of the bits are found to be set, the root expression is placed into the expression simulation engine for further processing. When the statement's expression has completed its simulation, the value of the root expression is used to determine if the next_true or next_false path will be taken. If the value of the root expression is true, the next_true statement is loaded into the statement simulation engine. If the value of the root expression is false and the next_false pointer is NULL, this signifies that the current statement tree has completed for this timestep. At this point, the current statement will set the <a class="el" href="group__expr__suppl.html#a4">SUPPL_LSB_STMT_HEAD</a> bit in its root expression and is removed from the statement simulation engine. The next statement at the head of the pre-simulation statement queue is then loaded into the statement simulation engine. If next_false statement is not NULL, it is loaded into the statement simulation engine and work is done on that statement.</dd></dl>
<dl compact><dt><b></b></dt><dd>When a root expression is placed into the expression simulation engine, the tree is traversed, following the paths that have set <a class="el" href="group__expr__suppl.html#a9">SUPPL_LSB_LEFT_CHANGED</a> or <a class="el" href="group__expr__suppl.html#a10">SUPPL_LSB_RIGHT_CHANGED</a> bits set. Each expression tree is traversed depth first. When an expression is reached that does not have either of these bits set, we have reached the expression whose value has changed. When this expression is found, it is evaluated and the resulting value is stored into its value vector. Once this has occurred, the parent expression checks to see if the other child expression has changed value. If so, that child expression's tree is traversed. Once both child expressions contain the current value for the current timestep, the parent expression evaluates its expression with the values of its children and clears both the <a class="el" href="group__expr__suppl.html#a9">SUPPL_LSB_LEFT_CHANGED</a> and <a class="el" href="group__expr__suppl.html#a10">SUPPL_LSB_RIGHT_CHANGED</a> bits to indicate that both children were evaluated. The resulting value is stored into the current expression's value vector and the parent expression of the current expression is worked on. This evaluation process continues until the root expression of the tree has been evaluated. At this point the expression tree is removed from the expression simulation engine and the associated statement worked on by the statement simulation engine as specified above.</dd></dl>
<hr><h2>Function Documentation</h2>
<a name="a7" doxytag="sim.c::sim_add_statics"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void sim_add_statics </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Adds static expression values to initial simulator. 
<p>
Iterates through static expression list and causes the simulator to evaluate these expressions at simulation time.     </td>
  </tr>
</table>
<a name="a6" doxytag="sim.c::sim_add_stmt_to_queue"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void sim_add_stmt_to_queue </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structstatement__s.html">statement</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>stmt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Adds specified statement to pre-simulation statement queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>stmt</em>&nbsp;</td><td>Pointer to statement to add to queue.</td></tr>
  </table>
</dl>
Checks STMT_HEAD bit of specified statement. If this is set to 1, adds this statement to the presimulation statement queue; otherwise, it does nothing with the statement     </td>
  </tr>
</table>
<a name="a5" doxytag="sim.c::sim_expr_changed"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void sim_expr_changed </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structexpression__s.html">expression</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>expr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Adds specified expression's statement to pre-simulation statement queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>expr</em>&nbsp;</td><td>Pointer to expression that contains a changed signal value.</td></tr>
  </table>
</dl>
Traverses up expression tree pointed to by leaf node expr, setting the CHANGED bits as it reaches the root expression. When the root expression is found, the statement pointed to by the root's parent pointer is added to the pre-simulation statement queue for simulation at the end of the timestep. If, upon traversing the tree, an expression is found to already be have a CHANGED bit set, we know that the statement has already been added, so stop here and do not add the statement again.     </td>
  </tr>
</table>
<a name="a8" doxytag="sim.c::sim_expression"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void sim_expression </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structexpression__s.html">expression</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>expr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>expr</em>&nbsp;</td><td>Pointer to expression to simulate.</td></tr>
  </table>
</dl>
Recursively traverses specified expression tree, following the <a class="el" href="group__expr__suppl.html#a9">SUPPL_LSB_LEFT_CHANGED</a> and <a class="el" href="group__expr__suppl.html#a10">SUPPL_LSB_RIGHT_CHANGED</a> bits in the supplemental field. Once an expression is found that has neither bit set, perform the expression operation and move back up the tree. Once both left and right children have calculated values, perform the expression operation for the current expression, clear both changed bits and return.     </td>
  </tr>
</table>
<a name="a10" doxytag="sim.c::sim_simulate"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void sim_simulate </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Simulates current timestep. 
<p>
This function is the heart of the simulation engine. It is called by the <a class="el" href="db_8c.html#a45">db_do_timestep()</a> function in <a class="el" href="db_8c.html">db.c</a> and moves the statements and expressions into the appropriate simulation functions. See above explanation on this procedure.     </td>
  </tr>
</table>
<a name="a9" doxytag="sim.c::sim_statement"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structstatement__s.html">statement</a>* sim_statement </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structstatement__s.html">statement</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>head_stmt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>head_stmt</em>&nbsp;</td><td>Pointer to head statement to simulate.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns a pointer to the first statement to execute in the next timestep</dd></dl>
Performs statement simulation as described above. Calls expression simulator if the associated root expression is specified that signals have changed value within it. Continues to run for current statement tree until statement tree hits a wait-for-event condition (or we reach the end of a simulation tree).     </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a name="a0" doxytag="sim.c::or_optab"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="defines_8h.html#a154">nibble</a> <a class="el" href="vector_8c.html#a2">or_optab</a>[16] </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
OR operation table     </td>
  </tr>
</table>
<a name="a3" doxytag="sim.c::presim_stmt_head"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structstmt__link__s.html">stmt_link</a>* <a class="el" href="sim_8c.html#a3">presim_stmt_head</a> = NULL
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pointer to head of statement list that contains all statements that will initially be simulated for the current timestep.     </td>
  </tr>
</table>
<a name="a4" doxytag="sim.c::presim_stmt_tail"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structstmt__link__s.html">stmt_link</a>* <a class="el" href="sim_8c.html#a4">presim_stmt_tail</a> = NULL
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pointer to tail of statement list that contains all statements that will initially be simulated for the current timestep.     </td>
  </tr>
</table>
<a name="a1" doxytag="sim.c::static_expr_head"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structexp__link__s.html">exp_link</a>* <a class="el" href="sim_8c.html#a1">static_expr_head</a> = NULL
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pointer to head of expression list that contains all expressions that contain static (non-changing) values. These expressions will be forced to be simulated, making sure that correct coverage numbers for expressions containing static values is maintained.     </td>
  </tr>
</table>
<a name="a2" doxytag="sim.c::static_expr_tail"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structexp__link__s.html">exp_link</a>* <a class="el" href="sim_8c.html#a2">static_expr_tail</a> = NULL
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pointer to tail of expression list that contains all expressions that contain static (non-changing) values. These expressions will be forced to be simulated, making sure that correct coverage numbers for expressions containing static values is maintained.     </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Aug 14 22:50:12 2003 for Covered by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.3 </small></address>
</body>
</html>
